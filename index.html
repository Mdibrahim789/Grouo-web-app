<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UU EEE Dept App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        :root {
            --bg-body: #f8f9fa; --bg-card: #ffffff; --text-main: #2d3436; --text-muted: #636e72;
            --primary: #6c5ce7; --primary-dark: #5844d6; --accent: #00cec9;
            --sidebar-bg: #2d3436; --sidebar-text: #dfe6e9; --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.1); --input-bg: #ffffff;
        }
        body.dark-mode {
            --bg-body: #0f172a; --bg-card: #1e293b; --text-main: #f1f5f9; --text-muted: #94a3b8;
            --primary: #818cf8; --primary-dark: #6366f1; --accent: #38bdf8;
            --sidebar-bg: #020617; --sidebar-text: #cbd5e1; --border: #334155; --input-bg: #334155;
        }
        * { box-sizing: border-box; transition: background 0.3s, color 0.3s; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: var(--bg-body); color: var(--text-main); display: flex; height: 100vh; overflow: hidden; }

        /* SIDEBAR */
        #sidebar { width: 260px; background: var(--sidebar-bg); color: var(--sidebar-text); padding: 20px; height: 100vh; position: fixed; left: 0; top: 0; z-index: 1000; transition: 0.3s; display: flex; flex-direction: column; }
        .brand { font-size: 1.5rem; font-weight: 800; color: white; margin-bottom: 30px; display: flex; align-items: center; gap: 10px; }
        .menu-items { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 5px; }
        .menu-btn { background: transparent; border: none; color: var(--sidebar-text); padding: 12px 15px; text-align: left; font-size: 0.95rem; cursor: pointer; border-radius: 10px; display: flex; align-items: center; gap: 12px; font-weight: 500; }
        .menu-btn:hover { background: rgba(255,255,255,0.1); }
        .menu-btn.active { background: linear-gradient(90deg, var(--primary), var(--primary-dark)); color: white; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        
        /* MAIN CONTENT */
        #main-content { flex: 1; margin-left: 260px; height: 100vh; overflow-y: auto; position: relative; }
        .mobile-header { display: none; background: var(--bg-card); padding: 15px; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 900; box-shadow: var(--shadow); }
        .content-section { display: none; padding: 25px; max-width: 1000px; margin: 0 auto; animation: fadeUp 0.4s; }
        .content-section.active-section { display: block; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        /* COMPONENTS */
        .card { background: var(--bg-card); padding: 20px; border-radius: 12px; box-shadow: var(--shadow); border: 1px solid var(--border); margin-bottom: 15px; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        h2 { margin: 0; font-size: 1.4rem; position: relative; }
        h2::after { content:''; display:block; width:40px; height:3px; background:var(--accent); margin-top:5px; border-radius:2px; }
        
        .admin-form { display: none; background: var(--bg-card); padding: 20px; border-radius: 12px; border-left: 4px solid var(--accent); margin-bottom: 20px; box-shadow: var(--shadow); }
        input, select, textarea { width: 100%; padding: 10px; margin: 5px 0; background: var(--input-bg); color: var(--text-main); border: 1px solid var(--border); border-radius: 6px; }
        .btn { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; }
        .btn-primary { background: var(--primary); color: white; width: 100%; margin-top: 10px; }
        .btn-sm { font-size: 0.8rem; padding: 5px 10px; }
        .btn-red { background: #ef4444; color: white; }

        /* SPECIFIC UI */
        .notice-banner { background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; padding: 25px; border-radius: 12px; margin-bottom: 25px; position: relative; overflow: hidden; }
        .notice-banner::before { content: 'üîî'; position: absolute; right: -10px; top: -10px; font-size: 6rem; opacity: 0.2; transform: rotate(15deg); }
        
        .routine-table { width: 100%; border-collapse: collapse; }
        .routine-table th, .routine-table td { padding: 12px; text-align: left; border-bottom: 1px solid var(--border); }
        
        /* Gallery Grid */
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; margin-top: 15px; }
        .gallery-item { position: relative; border-radius: 10px; overflow: hidden; height: 150px; border: 1px solid var(--border); }
        .gallery-item img { width: 100%; height: 100%; object-fit: cover; transition: 0.3s; }
        .gallery-item:hover img { transform: scale(1.1); }
        .gallery-caption { position: absolute; bottom: 0; left: 0; right: 0; background: rgba(0,0,0,0.6); color: white; font-size: 0.8rem; padding: 5px; text-align: center; }
        .gallery-del { position: absolute; top: 5px; right: 5px; background: red; color: white; width: 25px; height: 25px; border-radius: 50%; border:none; cursor: pointer; display: none; align-items:center; justify-content:center; }
        
        /* Dashboard Gallery Scroll */
        .dash-gallery { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; }
        .dash-gallery img { width: 120px; height: 80px; border-radius: 8px; object-fit: cover; border: 1px solid var(--border); }

        /* Responsive */
        @media (max-width: 768px) {
            #sidebar { transform: translateX(-100%); } #sidebar.open { transform: translateX(0); }
            #main-content { margin-left: 0; } .mobile-header { display: flex; } .content-section { padding: 15px; }
        }
        #loader { position: fixed; inset: 0; background: var(--bg-body); z-index: 2000; display: flex; justify-content: center; align-items: center; flex-direction: column; }
        .loader-ring { width: 40px; height: 40px; border: 4px solid var(--border); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s infinite linear; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="loader"><div class="loader-ring"></div><p style="margin-top:15px; font-weight:bold;">Loading Cloud Data...</p></div>
    <div id="overlay" onclick="toggleSidebar()" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:999;"></div>

    <div id="sidebar">
        <div class="brand"><i class="fa-solid fa-graduation-cap"></i> UU EEE</div>
        <div class="menu-items">
            <button onclick="nav('home')" id="btn-home" class="menu-btn active"><i class="fa-solid fa-house"></i> Dashboard</button>
            <button onclick="nav('gallery')" id="btn-gallery" class="menu-btn"><i class="fa-solid fa-images"></i> Gallery</button> <button onclick="nav('academic')" id="btn-academic" class="menu-btn"><i class="fa-solid fa-book"></i> Academic</button>
            <button onclick="nav('students')" id="btn-students" class="menu-btn"><i class="fa-solid fa-users"></i> Students</button>
            <button onclick="nav('teachers')" id="btn-teachers" class="menu-btn"><i class="fa-solid fa-chalkboard-user"></i> Faculty</button>
            <button onclick="nav('notice')" id="btn-notice" class="menu-btn"><i class="fa-solid fa-bell"></i> Notices</button>
            <button onclick="nav('attendance')" id="btn-attendance" class="menu-btn"><i class="fa-solid fa-clipboard-user"></i> Attendance</button>
            <button onclick="nav('polls')" id="btn-polls" class="menu-btn"><i class="fa-solid fa-square-poll-vertical"></i> Polls</button>
        </div>
        <div style="margin-top:auto; display:flex; flex-direction:column; gap:10px;">
            <button onclick="toggleTheme()" class="menu-btn" style="justify-content:center; background:rgba(255,255,255,0.05);"><i class="fa-solid fa-moon"></i> Theme</button>
            <button onclick="toggleAdmin()" id="admin-btn" class="menu-btn" style="justify-content:center; background:rgba(255,255,255,0.05);"><i class="fa-solid fa-lock"></i> Admin</button>
        </div>
    </div>

    <div id="main-content">
        <div class="mobile-header">
            <div onclick="toggleSidebar()"><i class="fa-solid fa-bars" style="font-size:1.4rem;"></i></div>
            <span style="font-weight:700;">Dept. of EEE</span>
            <div style="width:20px;"></div>
        </div>

        <div id="home" class="content-section active-section">
            
            <div id="dashboard-notice"></div>

            <div class="section-header" style="margin-top:20px;">
                <h2>üìÖ Class Routine</h2>
                <button class="btn btn-sm btn-primary" style="width:auto;" onclick="pdf('routine-table')">PDF</button>
            </div>
            <div class="admin-form">
                <input id="r-day" placeholder="Day"><input id="r-sub" placeholder="Subject"><input id="r-room" placeholder="Room">
                <button class="btn btn-primary" onclick="addRoutine()">Add Class</button>
            </div>
            <div class="card" style="padding:0; overflow:hidden;">
                <table class="routine-table" id="routine-table">
                    <thead style="background:var(--bg-body);"><tr><th>Time</th><th>Subject</th><th>Act</th></tr></thead>
                    <tbody id="routine-body"></tbody>
                </table>
            </div>

            <div class="section-header" style="margin-top:30px;"><h2>‚ö° Recent Activity</h2></div>
            <div id="activity-feed"></div>

            <div class="section-header" style="margin-top:30px;"><h2>üì∏ Photo Gallery</h2></div>
            <div id="dash-gallery" class="dash-gallery"></div>
        </div>

        <div id="gallery" class="content-section">
            <div class="admin-form">
                <h3>Upload Photo</h3>
                <input type="file" id="g-upload" accept="image/*">
                <input type="text" id="g-caption" placeholder="Caption (Optional)">
                <button class="btn btn-primary" onclick="addPhoto()">Upload to Gallery</button>
            </div>
            <h2>Department Gallery</h2>
            <div id="gallery-grid" class="gallery-grid"></div>
        </div>

        <div id="students" class="content-section">
            <div class="admin-form" id="student-form">
                <h3>Student Info</h3>
                <input type="file" id="s-img" accept="image/*">
                <input id="s-name" placeholder="Name"><input id="s-id" placeholder="ID"><input id="s-dip" placeholder="Dip. Session"><input id="s-phone" placeholder="Phone">
                <button class="btn btn-primary" id="stu-btn" onclick="addStudent()">Add</button>
                <button class="btn btn-primary" onclick="resetForm()" style="background:#64748b;">Cancel</button>
            </div>
            <div class="section-header"><h2>Student List</h2></div>
            <div id="student-list"></div>
        </div>

        <div id="academic" class="content-section">
            <div class="admin-form"><input id="sub-name" placeholder="Course"><input id="sub-code" placeholder="Code"><input id="sub-link" placeholder="Link"><button class="btn btn-primary" onclick="addSubject()">Add</button></div>
            <h2>Active Courses</h2><div id="course-list"></div>
        </div>

        <div id="teachers" class="content-section">
            <div class="admin-form"><input id="t-name" placeholder="Name"><input id="t-post" placeholder="Post"><input id="t-phone" placeholder="Phone"><button class="btn btn-primary" onclick="addTeacher()">Add</button></div>
            <h2>Faculty</h2><div id="teacher-list"></div>
        </div>

        <div id="notice" class="content-section">
            <div class="admin-form"><input type="date" id="n-date"><input id="n-title" placeholder="Title"><input id="n-desc" placeholder="Details"><button class="btn btn-primary" onclick="addNotice()">Post</button></div>
            <h2>Notices</h2><div id="notice-list"></div>
        </div>

        <div id="attendance" class="content-section">
            <div class="admin-form"><input type="date" id="att-date"><input id="att-sub" placeholder="Subject"><div id="att-grid" class="gallery-grid" style="grid-template-columns:repeat(auto-fill,minmax(80px,1fr));"></div><button class="btn btn-primary" onclick="saveAttendance()">Save</button></div>
            <h2>History</h2><div id="att-history"></div>
        </div>
        <div id="polls" class="content-section">
            <div class="admin-form"><input id="p-q" placeholder="Q"><input id="p-o" placeholder="Options"><button class="btn btn-primary" onclick="addPoll()">Create</button></div>
            <h2>Polls</h2><div id="poll-list"></div>
        </div>
    </div>

    <script>
        const BIN_ID = "696ddab4ae596e708fe5fa10"; 
        const MASTER_KEY = "$2a$10$KTYAb9AoPKihFgFBHUpPZ.w4pn1jq7NHptoZVp4iPFf3u0k6xmWly";

        let data = { routine:[], student:[], teacher:[], notice:[], attendance:[], polls:[], courses:[], gallery:[] };
        let isAdmin = false;
        let editIdx = -1;

        function toggleTheme() { document.body.classList.toggle('dark-mode'); localStorage.setItem('theme', document.body.classList.contains('dark-mode')?'dark':'light'); }
        if(localStorage.getItem('theme')==='dark') document.body.classList.add('dark-mode');

        function nav(id) {
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active-section'));
            document.getElementById(id).classList.add('active-section');
            document.querySelectorAll('.menu-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btn-'+id).classList.add('active');
            toggleSidebar(false);
        }
        function toggleSidebar(forceClose) {
            const sb=document.getElementById('sidebar'), ov=document.getElementById('overlay');
            if(forceClose===false){ sb.classList.remove('open'); ov.style.display='none'; }
            else{ sb.classList.toggle('open'); ov.style.display=sb.classList.contains('open')?'block':'none'; }
        }

        async function init() {
            try {
                let res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, { headers: { "X-Master-Key": MASTER_KEY } });
                let json = await res.json();
                data = json.record;
                ['routine','student','teacher','notice','attendance','polls','courses','gallery'].forEach(k => { if(!data[k]) data[k]=[]; });
                render(); document.getElementById('loader').style.display='none';
            } catch(e) { alert("Network Error"); document.getElementById('loader').style.display='none'; }
        }

        async function save() {
            try { await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, { method: "PUT", headers: { "Content-Type": "application/json", "X-Master-Key": MASTER_KEY }, body: JSON.stringify(data) }); render(); } catch(e) {}
        }

        function render() {
            // A. Notice Banner
            const ban = document.getElementById('dashboard-notice');
            if(data.notice.length) {
                let n = data.notice[data.notice.length-1];
                ban.innerHTML = `<div class="notice-banner"><div><span style="background:rgba(255,255,255,0.2);padding:2px 8px;border-radius:20px;font-size:0.8rem;">üìÖ ${n.date}</span><h3 style="margin:5px 0;">${n.title}</h3><p style="margin:0;opacity:0.9">${n.desc}</p></div></div>`;
            } else ban.innerHTML = '';

            // B. Routine
            const rBody = document.getElementById('routine-body'); rBody.innerHTML='';
            data.routine.forEach((r,i) => rBody.innerHTML += `<tr><td style="color:var(--primary);font-weight:700">${r.day}</td><td>${r.sub}<br><small style="color:var(--text-muted)">${r.room}</small></td><td><button class="btn-sm btn-red delete-btn" onclick="del('routine',${i})">X</button></td></tr>`);

            // C. Activity
            const feed = document.getElementById('activity-feed'); feed.innerHTML='';
            if(data.polls.length) {
                let p = data.polls[data.polls.length-1];
                feed.innerHTML += `<div class="card" onclick="nav('polls')" style="background:linear-gradient(135deg, #f39c12, #d35400);color:white;cursor:pointer;"><b>üó≥Ô∏è Active Poll: ${p.question}</b><br><small>Tap to vote</small></div>`;
            } else feed.innerHTML = '<p style="color:var(--text-muted)">No recent activity.</p>';

            // D. Gallery (Main + Dashboard)
            const gGrid = document.getElementById('gallery-grid');
            const dGrid = document.getElementById('dash-gallery');
            gGrid.innerHTML = ''; dGrid.innerHTML = '';
            
            data.gallery.slice().reverse().forEach((g,i) => {
                const realIdx = data.gallery.length - 1 - i;
                // Main Grid
                gGrid.innerHTML += `<div class="gallery-item"><img src="${g.src}"><div class="gallery-caption">${g.cap}</div><button class="gallery-del delete-btn" onclick="del('gallery',${realIdx})">X</button></div>`;
                // Dashboard Preview (Limit 5)
                if(i < 5) dGrid.innerHTML += `<img src="${g.src}" style="cursor:pointer;" onclick="nav('gallery')">`;
            });

            // Students
            const sList = document.getElementById('student-list'); sList.innerHTML='';
            data.student.forEach((s,i) => {
                let img = s.img || 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png';
                let btns = isAdmin ? `<div><button class="btn-sm" style="background:#f59e0b;color:white;" onclick="editS(${i})"><i class="fa-solid fa-pen"></i></button><button class="btn-sm btn-red delete-btn" onclick="del('student',${i})"><i class="fa-solid fa-trash"></i></button></div>` : '';
                sList.innerHTML += `<div class="card" style="display:flex;align-items:center;justify-content:space-between;"><div style="display:flex;align-items:center;gap:15px;"><img src="${img}" style="width:45px;height:45px;border-radius:50%;object-fit:cover;"><div><div style="font-weight:700;">${s.name}</div><div style="font-size:0.85rem;color:var(--text-muted);">ID: ${s.id}</div><div onclick="copy('${s.phone}')" style="color:var(--accent);font-size:0.85rem;cursor:pointer;">üìû ${s.phone}</div></div></div>${btns}</div>`;
            });

            // Attendance Grid
            const attGrid = document.getElementById('att-grid');
            if(attGrid.innerHTML === '') {
                data.student.forEach(s => attGrid.innerHTML += `<div id="att-p-${s.id}" style="background:var(--bg-body);border:1px solid var(--border);padding:5px;border-radius:5px;text-align:center;cursor:pointer;font-size:0.8rem;" onclick="toggleP('${s.id}')">${s.name}</div>`);
            }

            // Other Modules (Simplified)
            const cList=document.getElementById('course-list'); cList.innerHTML=''; data.courses.forEach((c,i)=>cList.innerHTML+=`<div class="card"><b>${c.name}</b> (${c.code}) <a href="${c.link}" target="_blank" style="float:right;color:var(--primary);">Link</a> <button class="btn-sm btn-red delete-btn" onclick="del('courses',${i})">X</button></div>`);
            const tList=document.getElementById('teacher-list'); tList.innerHTML=''; data.teacher.forEach((t,i)=>tList.innerHTML+=`<div class="card"><b>${t.name}</b><br>${t.post}<button class="btn-sm btn-red delete-btn" onclick="del('teacher',${i})" style="float:right">X</button></div>`);
            const nList=document.getElementById('notice-list'); nList.innerHTML=''; data.notice.slice().reverse().forEach((n,i)=>nList.innerHTML+=`<div class="card" style="border-left:4px solid var(--accent)"><b>${n.title}</b><br>${n.desc}<button class="btn-sm btn-red delete-btn" onclick="del('notice',${data.notice.length-1-i})" style="float:right">X</button></div>`);
            const pList=document.getElementById('poll-list'); pList.innerHTML=''; data.polls.slice().reverse().forEach((p,i)=>{let idx=data.polls.length-1-i; let opts=p.options.map((o,oi)=>`<div style="background:var(--bg-body);padding:8px;margin:5px 0;border-radius:6px;cursor:pointer;" onclick="vote(${idx},${oi})">${o.text} (${o.votes})</div>`).join(''); pList.innerHTML+=`<div class="card"><b>${p.question}</b>${opts}<button class="btn-sm btn-red delete-btn" onclick="del('polls',${idx})">End</button></div>`;});
            const attH=document.getElementById('att-history'); attH.innerHTML=''; data.attendance.slice().reverse().forEach((a,i)=>{let idx=data.attendance.length-1-i; attH.innerHTML+=`<div class="card"><b>${a.subject}</b> - ${a.date} (${a.ids.length}) <button class="btn-sm btn-red delete-btn" onclick="del('attendance',${idx})" style="float:right">X</button></div>`;});

            checkAdmin();
        }

        // --- ACTIONS ---
        function toggleAdmin(){ isAdmin=!isAdmin; checkAdmin(); }
        function checkAdmin(){
            document.querySelectorAll('.admin-form').forEach(e => e.style.display = isAdmin ? 'block' : 'none');
            document.querySelectorAll('.delete-btn').forEach(e => e.style.display = isAdmin ? 'inline-flex' : 'none');
            document.querySelectorAll('.gallery-del').forEach(e => e.style.display = isAdmin ? 'flex' : 'none');
            const btn = document.getElementById('admin-btn');
            btn.innerHTML = isAdmin ? '<i class="fa-solid fa-unlock"></i> Logout' : '<i class="fa-solid fa-lock"></i> Admin';
            btn.style.color = isAdmin ? '#ef4444' : 'var(--sidebar-text)';
        }

        function v(id){ return document.getElementById(id).value; }
        
        function addStudent(){
            let n=v('s-name'), i=v('s-id'), d=v('s-dip'), p=v('s-phone'), f=document.getElementById('s-img').files[0];
            if(!n) return alert("Name?");
            const commit = (img) => {
                if(editIdx > -1) data.student[editIdx] = {name:n, id:i, dip:d, phone:p, img:img || data.student[editIdx].img};
                else data.student.push({name:n, id:i, dip:d, phone:p, img:img});
                resetForm(); save();
            };
            if(f){ const r=new FileReader(); r.onload=(e)=>commit(e.target.result); r.readAsDataURL(f); } else commit('');
        }
        function editS(i) { let s = data.student[i]; document.getElementById('s-name').value=s.name; document.getElementById('s-id').value=s.id; document.getElementById('s-dip').value=s.dip; document.getElementById('s-phone').value=s.phone; editIdx=i; document.getElementById('stu-btn').innerText="Update"; document.getElementById('student-form').scrollIntoView(); }
        function resetForm(){ document.querySelectorAll('input').forEach(i=>i.value=''); editIdx=-1; document.getElementById('stu-btn').innerText="Add"; }

        // Gallery Logic
        function addPhoto() {
            const f = document.getElementById('g-upload').files[0];
            const c = v('g-caption');
            if(f) {
                const r = new FileReader();
                r.onload = (e) => {
                    data.gallery.push({src: e.target.result, cap: c});
                    save();
                    document.getElementById('g-upload').value = '';
                    document.getElementById('g-caption').value = '';
                };
                r.readAsDataURL(f);
            } else alert("Select Image");
        }

        let presentSet = new Set();
        function toggleP(id) { if(presentSet.has(id)){ presentSet.delete(id); document.getElementById('att-p-'+id).style.background=''; document.getElementById('att-p-'+id).style.color=''; } else { presentSet.add(id); document.getElementById('att-p-'+id).style.background='#10b981'; document.getElementById('att-p-'+id).style.color='white'; } }
        function saveAttendance() { if(!v('att-date')) return alert("Date?"); data.attendance.push({date:v('att-date'), subject:v('att-sub'), ids:Array.from(presentSet)}); presentSet.clear(); save(); }

        function addRoutine(){ if(v('r-day')) { data.routine.push({day:v('r-day'),sub:v('r-sub'),room:v('r-room')}); save(); } }
        function addSubject(){ if(v('sub-name')) { data.courses.push({name:v('sub-name'),code:v('sub-code'),link:v('sub-link')}); save(); } }
        function addTeacher(){ if(v('t-name')) { data.teacher.push({name:v('t-name'),post:v('t-post'),phone:v('t-phone')}); save(); } }
        function addNotice(){ if(v('n-title')) { data.notice.push({date:v('n-date'),title:v('n-title'),desc:v('n-desc')}); save(); } }
        function addPoll(){ if(v('p-q')) { data.polls.push({question:v('p-q'), options:v('p-o').split(',').map(t=>({text:t.trim(),votes:0}))}); save(); } }
        function vote(pi,oi){ if(localStorage.getItem('v_'+pi)) return alert("Voted!"); data.polls[pi].options[oi].votes++; localStorage.setItem('v_'+pi,1); save(); }
        
        function del(k,i) { if(confirm("Delete?")) { data[k].splice(i,1); save(); } }
        function copy(t) { navigator.clipboard.writeText(t); alert("Copied"); }
        function pdf(id) { const e=document.getElementById(id); html2pdf().from(e).save('doc.pdf'); }

        init();
    </script>
</body>
</html>
